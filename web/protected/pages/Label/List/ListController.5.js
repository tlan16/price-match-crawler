var PageJs=new Class.create;
PageJs.prototype=Object.extend(new CRUDPageJs,{_getTitleRowData:function(){return{id:"ID",active:"Active",name:"Name",description:"Description"}},_bindSearchKey:function(){var a;a=this;$("searchPanel").getElementsBySelector("[search_field]").each(function(c){c.observe("keydown",function(e){a.keydown(e,function(){$("searchBtn").click()})})});return this},loadSelect2:function(){var a,c;jQuery("select.select2").each(function(){a={};if("Infinity"===$(this).readAttribute("data-minimum-results-for-search")||"infinity"===
$(this).readAttribute("data-minimum-results-for-search")||-1==$(this).readAttribute("data-minimum-results-for-search"))a.minimumResultsForSearch="Infinity";jQuery(this).select2(a)});jQuery('[search_field="ingr.allergents"]').select2({allowClear:!0,multiple:!0,width:"100%",ajax:{delay:250,url:"/ajax/getAll",type:"GET",data:function(a){return{searchTxt:"name like ?",searchParams:["%"+a+"%"],entityName:"Allergent",pageNo:1}},results:function(a,d,b){c=[];a.resultData&&a.resultData.items&&a.resultData.items.each(function(a){c.push({id:a.id,
text:a.name,data:a})});return{results:c}}},cache:!0,escapeMarkup:function(a){return a}})},_getResultRow:function(a,c){var e,d,b;e=this;d=c||!1;b=!0===d?"strong":"span";return(new Element("span",{"class":"row"})).store("data",a).addClassName(!1===a.active&&!1===d?"warning":"").addClassName("list-group-item").addClassName("item_row").writeAttribute("item_id",a.id).insert({bottom:(new Element(b,{"class":"name col-md-6"})).update(a.name)}).insert({bottom:(new Element(b,{"class":"description col-md-2"})).update(a.description)}).insert({bottom:(new Element(b,
{"class":"allergents col-md-2"})).update(!0===d?"Allgergents":e._getNamesString(a.infos.allergents))}).insert({bottom:(new Element(b,{"class":"text-right btns col-md-2"})).update(!0===d?(new Element("span",{"class":"btn btn-primary btn-xs",title:"New"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){e._openDetailsPage()}):(new Element("span",{"class":"btn-group btn-group-xs"})).insert({bottom:(new Element("span",{"class":"btn btn-primary",
title:"Delete"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-pencil"})}).observe("click",function(){e._openDetailsPage(a)})}).insert({bottom:(new Element("span")).addClassName(!1===a.active&&!1===d?"btn btn-success":"btn btn-danger").writeAttribute("title",!1===a.active&&!1===d?"Re-activate":"De-activate").insert({bottom:(new Element("span")).addClassName(!1===a.active&&!1===d?"glyphicon glyphicon-repeat":"glyphicon glyphicon-trash")}).observe("click",function(){if(!confirm("Are you sure you want to "+
(!0===a.active?"DE-ACTIVATE":"RE-ACTIVATE")+" this item?"))return!1;e._deleteItem(a,a.active)})}))})},_openDetailsPage:function(a){jQuery.fancybox({width:"95%",height:"95%",modal:!0,autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/label/"+(a?a.id:"new")+".html",helpers:{overlay:{locked:!1}},beforeClose:function(){}});return this},_updateItem:function(a,c,e,d){var b,f,g,h;b=this;c={itemId:$(a).up(".item_row[item_id]").readAttribute("item_id"),entityId:c,newValue:e,method:d};
if(null!==c)return b.postAjax(b.getCallbackId("updateItem"),c,{onLoading:function(){$(a).hide()},onSuccess:function(c,d){try{(f=b.getResp(d,!1,!0))&&f.item&&(g=$(b.resultDivId).down("#"+b.resultDivId+"-body").down(".item_row[item_id="+f.item.id+"]"),h=b._getResultRow(f.item).addClassName("list-group-item").addClassName("item_row").writeAttribute("item_id",f.item.id),g.replace(h))}catch(e){b.showModalBox('<span class="text-danger">ERROR:</span>',e,!0),$(a).show()}}}),b}});